<!DOCTYPE html>


<html lang="en"
      data-build-env="local"
      data-build-run="‚Äî"
      data-build-ts="‚Äî"
      data-cache-bust="1">
<head>
  <!--
    SpectraMind V50 ‚Äî Diagnostics Dashboard (Hardened v4)
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    Goals
      ‚Ä¢ Offline-first, zero-deps (no external fonts/libs)
      ‚Ä¢ Print-friendly (trim chrome; high-contrast in B/W)
      ‚Ä¢ A11y-first: keyboard, reduced-motion, landmarks, labels
      ‚Ä¢ Deterministic theming: light/dark/auto + persistence
      ‚Ä¢ CLI-friendly: hydrate via ./dashboard_data.json OR data-* attributes
      ‚Ä¢ Embeddable previews: <img data-asset="..."> -> swaps to <iframe> on ?embed=1
      ‚Ä¢ Safe error handling: soft-degrade when assets/data missing


CLI hooks (examples)
  ‚Ä¢ Replace <html data-*>, or set text in #build-*
  ‚Ä¢ Write ./dashboard_data.json with shape (see JSON schema near bottom)
  ‚Ä¢ Drop images/iframes next to this file (e.g., ./umap_clusters.png, ./umap.html)
  ‚Ä¢ Update ./log_table.md and link below

Keyboard
  ‚Ä¢ ?      : Toggle shortcuts/help panel
  ‚Ä¢ r      : Soft refresh images (cache-bust)
  ‚Ä¢ t      : Cycle theme (auto ‚Üí dark ‚Üí light)
  ‚Ä¢ e      : Toggle embed mode (?embed=1)
  ‚Ä¢ g      : Jump to Overview (focus)

‚Äì>




  <title>SpectraMind V50 ‚Äî Diagnostics Dashboard</title>


  <style>
    :root{
      --bg:#f7f7fb;--surface:#ffffff;--ink:#1f2328;--muted:#6b7280;--accent:#2b2d42;--accent-2:#5da9ff;
      --border:#e7e7ee;--ok:#16a34a;--warn:#f59e0b;--err:#dc2626;--info:#2563eb;
      --radius:16px;--pad:16px;--gap:16px;--ts:200ms ease;
      --fs-xxl:clamp(22px,2.4vw,28px);--fs-xl:clamp(18px,2vw,22px);--fs-lg:16px;--fs-md:14px;--fs-sm:12px;
      --shadow:0 4px 22px rgba(27,31,35,.06);
      --ring:3px solid color-mix(in oklab,var(--accent-2)40%,transparent);
    }
    /* Dark */
    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0c1116;--surface:#0f141a;--ink:#d1d5db;--muted:#9aa4af;--accent:#8ab4ff;--accent-2:#60a5fa;--border:#1f2a36;
        --ok:#22c55e;--warn:#f59e0b;--err:#f87171;--info:#60a5fa;
        --shadow:0 6px 28px rgba(0,0,0,.35);
      }
    }
    /* Force theme via [data-theme] */
    html[data-theme="light"]{
      color-scheme: light;
    }
    html[data-theme="dark"]{
      color-scheme: dark;
      --bg:#0c1116;--surface:#0f141a;--ink:#d1d5db;--muted:#9aa4af;--accent:#8ab4ff;--accent-2:#60a5fa;--border:#1f2a36;
      --ok:#22c55e;--warn:#f59e0b;--err:#f87171;--info:#60a5fa;--shadow:0 6px 28px rgba(0,0,0,.35);
    }

    /* Motion / Contrast */
    @media (prefers-reduced-motion: reduce){
      *{animation:none!important;transition:none!important;scroll-behavior:auto!important}
    }

    html,body{height:100%;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial,"Noto Sans",sans-serif;line-height:1.45;text-rendering:optimizeLegibility}
    a{color:var(--accent-2);text-decoration:none}
    a:hover{text-decoration:underline}
    .sr-only{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap;border:0}

    .wrap{max-width:1400px;margin:0 auto;padding:20px;display:grid;gap:var(--gap);grid-template-columns:1fr}

    /* App bar */
    header.appbar{
      position:sticky;top:0;z-index:10;background:color-mix(in oklab,var(--bg)80%,var(--surface)20%);
      -webkit-backdrop-filter:saturate(120%) blur(6px);backdrop-filter:saturate(120%) blur(6px);
      border-bottom:1px solid var(--border);box-shadow:var(--shadow);
      display:flex;justify-content:space-between;align-items:center;padding:10px 16px;border-radius:0 0 var(--radius) var(--radius)
    }
    .brand{display:flex;align-items:center;gap:12px;font-size:var(--fs-xl);font-weight:700;letter-spacing:.2px}
    .badge{padding:4px 10px;border-radius:999px;font-size:var(--fs-sm);font-weight:600;color:var(--surface);background:var(--accent)}
    .toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .btn{appearance:none;border:1px solid var(--border);background:var(--surface);color:var(--ink);
      padding:8px 12px;border-radius:10px;font-size:var(--fs-md);font-weight:600;cursor:pointer;transition:transform var(--ts),background var(--ts),border-color var(--ts)}
    .btn:hover{transform:translateY(-1px);border-color:var(--accent-2)}
    .btn.primary{background:var(--accent);border-color:var(--accent);color:#fff}
    .btn:focus-visible{outline:var(--ring);outline-offset:2px}

    /* Grid/cards */
    .grid{display:grid;gap:var(--gap);grid-template-columns:repeat(12,1fr);grid-auto-rows:minmax(120px,auto)}
    .span-12{grid-column:span 12}.span-8{grid-column:span 8}.span-6{grid-column:span 6}.span-4{grid-column:span 4}.span-3{grid-column:span 3}
    @media (max-width:1200px){.span-8,.span-6,.span-4{grid-column:span 12}.span-3{grid-column:span 6}}
    @media (max-width:720px){.span-3{grid-column:span 12}}

    .card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);
      padding:var(--pad);display:flex;flex-direction:column;gap:10px;min-height:120px;overflow:hidden}
    .card h3{margin:0;font-size:var(--fs-lg);font-weight:700;letter-spacing:.2px}
    .muted{color:var(--muted);font-size:var(--fs-sm)}

    .kpis{display:grid;gap:10px;grid-template-columns:repeat(3,1fr)}
    @media (max-width:1200px){.kpis{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:720px){.kpis{grid-template-columns:1fr}}
    .kpi{background:color-mix(in oklab,var(--surface)85%,var(--bg)15%);border:1px dashed var(--border);border-radius:12px;padding:12px;display:grid;gap:6px}
    .kpi .label{color:var(--muted);font-size:var(--fs-sm)}
    .kpi .value{font-size:var(--fs-xl);font-weight:800}

    .pill{display:inline-block;padding:2px 8px;border-radius:999px;font-weight:700;font-size:var(--fs-sm);color:#fff}
    .pill.ok{background:var(--ok)} .pill.warn{background:var(--warn)} .pill.err{background:var(--err)} .pill.info{background:var(--info)}

    .preview{display:grid;place-items:center;background:color-mix(in oklab,var(--surface)92%,var(--bg)8%);border:1px dashed var(--border);border-radius:12px;padding:8px;min-height:220px;overflow:hidden}
    .preview img,.preview iframe{max-width:100%;max-height:360px;border-radius:10px;border:1px solid var(--border);display:block}

    .links{display:grid;gap:6px;grid-template-columns:1fr 1fr}
    @media (max-width:720px){.links{grid-template-columns:1fr}}
    .link{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border-radius:10px;background:color-mix(in oklab,var(--surface)85%,var(--bg)15%);border:1px solid var(--border);text-decoration:none;color:var(--ink);font-weight:600;font-size:var(--fs-md)}
    .link:hover{border-color:var(--accent-2)}

    .table{width:100%;border-collapse:collapse;border:1px solid var(--border);border-radius:12px;overflow:hidden;font-size:var(--fs-sm)}
    .table th,.table td{padding:10px;border-bottom:1px solid var(--border);text-align:left;vertical-align:top}
    .table thead th{background:color-mix(in oklab,var(--surface)80%,var(--bg)20%);font-size:var(--fs-md)}

    /* Help/shortcuts panel */
    details.help{border:1px solid var(--border);border-radius:12px;background:color-mix(in oklab,var(--surface)90%,var(--bg)10%);padding:10px}
    details.help summary{cursor:pointer;font-weight:700}
    .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;background:color-mix(in oklab,var(--surface)80%,var(--bg)20%);border:1px solid var(--border);border-radius:6px;padding:0 6px}

    /* print */
    @media print{
      header.appbar, .toolbar, footer, details.help{display:none!important}
      body{background:#fff;color:#000}
      .card{box-shadow:none;border-color:#999}
      .link{border-color:#999}
    }

    :focus-visible{outline:var(--ring);outline-offset:2px;border-radius:8px}
  </style>


</head>
<body>
<a href="#main" class="sr-only">Skip to main content</a>


<header class="appbar" role="banner" aria-label="SpectraMind Diagnostics Toolbar">
  <div class="brand" aria-label="Project Title">
    <span>üõ∞Ô∏è SpectraMind V50</span>
    <span class="badge" title="Ariel Data Challenge 2025">Ariel 2025</span>
  </div>
  <div class="toolbar" role="group" aria-label="Dashboard actions">
    <button class="btn" id="refreshBtn" title="Soft reload images (cache-bust)"><span aria-hidden="true">‚Üª</span> Soft Refresh</button>
    <button class="btn" id="toggleThemeBtn" title="Toggle light/dark/auto"><span aria-hidden="true">‚òØ</span> Theme</button>
    <button class="btn" id="toggleEmbedBtn" title="Toggle embed mode (images ‚Üî iframes)"><span aria-hidden="true">‚ßâ</span> Embed</button>
    <a class="btn" href="./report.html" title="Open detailed diagnostics report">Open Full Report</a>
    <a class="btn primary" href="../README.md" title="Open project README">Project README</a>
  </div>
</header>


<main id="main" class="wrap" role="main" aria-live="polite">
  <!-- Keyboard help -->
  <details class="help card span-12" aria-label="Keyboard shortcuts and tips">
    <summary>Keyboard ‚Ä¢ <span class="kbd">?</span> to toggle</summary>
    <ul>
      <li><span class="kbd">r</span> Soft refresh images (cache-bust)</li>
      <li><span class="kbd">t</span> Cycle theme (auto ‚Üí dark ‚Üí light)</li>
      <li><span class="kbd">e</span> Toggle embed mode (?embed=1)</li>
      <li><span class="kbd">g</span> Jump to Overview (focus)</li>
    </ul>
    <p class="muted">Tip: Append <code>?theme=dark</code> or <code>?embed=1</code> to the URL for direct toggles.</p>
  </details>


  <!-- Overview / KPIs -->


  <section class="card span-12" aria-labelledby="sec-overview">
    <h3 id="sec-overview">Overview</h3>
    <div class="muted">
      Seed dashboard ‚Äî safe before first run. CLI overwrites KPIs, build info, and figures post-diagnostics.<br/>
      Build: <span id="build-env">local</span> ‚Ä¢ Run: <span id="build-run">‚Äî</span> ‚Ä¢ TS (UTC): <span id="build-ts">‚Äî</span>
    </div>
    <div class="kpis" role="list">
      <div class="kpi" role="listitem">
        <div class="label">Last Run Status</div>
        <div class="value"><span class="pill warn" id="kpi-status" aria-live="polite">PENDING</span></div>
        <div class="muted">Set by generator</div>
      </div>
      <div class="kpi" role="listitem">
        <div class="label">GLL Œî (‚Üì better)</div>
        <div class="value" id="kpi-gll">‚Äî</div>
        <div class="muted">Across 283 bins</div>
      </div>
      <div class="kpi" role="listitem">
        <div class="label">Conformal Coverage</div>
        <div class="value" id="kpi-coverage">‚Äî</div>
        <div class="muted">COREL / œÉ calibration</div>
      </div>
    </div>
  </section>


  <!-- Quick links -->


  <section class="card span-12" aria-labelledby="sec-links">
    <h3 id="sec-links">Quick Links</h3>
    <div class="links">
      <a class="link" href="./ARCHITECTURE.md" title="Open architecture document">üìê Architecture</a>
      <a class="link" href="./log_table.md" title="Open CLI call summary (if generated)">ü™µ CLI Log Table</a>
    </div>
  </section>


  <!-- Visuals -->


  <section class="card span-6" aria-labelledby="sec-umap">
    <h3 id="sec-umap">UMAP ‚Äî Latent Clusters</h3>
    <div class="preview"><img alt="UMAP clusters (placeholder)" loading="lazy" data-asset="umap" src="./umap_clusters.png" /></div>
    <div class="muted">Hook: <code>data-asset="umap"</code> (or <code>umap.html</code>)</div>
  </section>


  <section class="card span-6" aria-labelledby="sec-tsne">
    <h3 id="sec-tsne">t-SNE ‚Äî Latent Projection</h3>
    <div class="preview"><img alt="t-SNE projection (placeholder)" loading="lazy" data-asset="tsne" src="./tsne_projection.png" /></div>
    <div class="muted">Hook: <code>data-asset="tsne"</code></div>
  </section>


  <section class="card span-6" aria-labelledby="sec-shap">
    <h3 id="sec-shap">SHAP √ó Œº Overlay</h3>
    <div class="preview"><img alt="SHAP overlay (placeholder)" loading="lazy" data-asset="shap" src="./shap_overlay.png" /></div>
    <div class="muted">Hook: <code>data-asset="shap"</code></div>
  </section>


  <section class="card span-6" aria-labelledby="sec-mu">
    <h3 id="sec-mu">Sample Œº Spectrum</h3>
    <div class="preview"><img alt="Œº spectrum (placeholder)" loading="lazy" data-asset="mu" src="./sample_spectrum.png" /></div>
    <div class="muted">Hook: <code>data-asset="mu"</code></div>
  </section>


  <section class="card span-6" aria-labelledby="sec-fft">
    <h3 id="sec-fft">FFT Power / Autocorr</h3>
    <div class="preview"><img alt="FFT power (placeholder)" loading="lazy" data-asset="fft" src="./fft_power.png" /></div>
    <div class="muted">Hook: <code>data-asset="fft"</code></div>
  </section>


  <section class="card span-6" aria-labelledby="sec-symbolic">
    <h3 id="sec-symbolic">Symbolic Rule Violations</h3>
    <div class="preview"><img alt="Symbolic violations heatmap (placeholder)" loading="lazy" data-asset="symbolic" src="./symbolic_heatmap.png" /></div>
    <div class="muted">Hook: <code>data-asset="symbolic"</code></div>
  </section>


  <section class="card span-6" aria-labelledby="sec-calib">
    <h3 id="sec-calib">œÉ Calibration / Residuals</h3>
    <div class="preview"><img alt="Calibration curve (placeholder)" loading="lazy" data-asset="calibration" src="./calibration_curve.png" /></div>
    <div class="muted">Hook: <code>data-asset="calibration"</code></div>
  </section>


  <!-- Recent CLI Calls -->


  <section class="card span-6" aria-labelledby="sec-cli">
    <h3 id="sec-cli">Recent CLI Calls</h3>
    <table class="table" aria-describedby="cli-desc">
      <caption id="cli-desc" class="sr-only">Recent CLI calls (time, command, status)</caption>
      <thead><tr><th style="width:30%">When (UTC)</th><th>Command</th><th style="width:15%">Status</th></tr></thead>
      <tbody id="cli-rows">
        <tr><td>‚Äî</td><td><code>spectramind diagnose dashboard</code></td><td><span class="pill warn">PENDING</span></td></tr>
        <tr><td>‚Äî</td><td><code>spectramind train +diagnostics.light=true</code></td><td><span class="pill warn">PENDING</span></td></tr>
        <tr><td>‚Äî</td><td><code>spectramind analyze-log --md</code></td><td><span class="pill warn">PENDING</span></td></tr>
      </tbody>
    </table>
    <div class="muted">Generator replaces this seed. See <a href="./log_table.md">log_table.md</a>.</div>
  </section>


  <!-- How-To -->


  <section class="card span-12" aria-labelledby="sec-howto">
    <h3 id="sec-howto">Regenerate This Dashboard</h3>
    <ol>
      <li>Run diagnostics (light mode example): <code>spectramind diagnose dashboard +diagnostics.light=true</code></li>
      <li>Optional: <code>spectramind analyze-log --md</code> ‚Üí updates <code>log_table.md</code></li>
      <li>Open <code>assets/report.html</code> for the full detail</li>
    </ol>
    <div class="muted">CLI overwrites KPI text and <code>img[data-asset]</code> sources (or swaps to sidecar HTMLs).</div>
  </section>
</main>


<footer role="contentinfo" class="wrap">
  <section class="card span-12">
    <div class="muted">SpectraMind V50 ‚Äî Ariel Data Challenge 2025 ‚Ä¢ Neuro-symbolic, physics-informed AI for exoplanet spectroscopy</div>
  </section>
</footer>


<noscript>
  <div class="wrap">
    <section class="card span-12" role="note" aria-label="No JavaScript">
      <strong>Note:</strong> JavaScript is disabled. Static placeholders are shown. The CLI can pre-render this file by writing values and swapping image src attributes.
    </section>
  </div>
</noscript>


<script>
(function(){
  "use strict";

  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   * Build metadata hydration
   * ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  const htmlEl = document.documentElement;
  const setText = (id, v) => { const el = document.getElementById(id); if(el) el.textContent = v; };
  setText("build-env", htmlEl.getAttribute("data-build-env") || "local");
  setText("build-run", htmlEl.getAttribute("data-build-run") || "‚Äî");
  setText("build-ts",  htmlEl.getAttribute("data-build-ts")  || new Date().toISOString());

  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   * Theme control (auto/dark/light)
   * ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  const THEME_KEY = 'smv50_theme';
  const toggleBtn = document.getElementById('toggleThemeBtn');
  function setTheme(mode){
    if(mode==='auto'){ document.documentElement.removeAttribute('data-theme'); localStorage.removeItem(THEME_KEY); }
    else { document.documentElement.setAttribute('data-theme', mode); localStorage.setItem(THEME_KEY, mode); }
  }
  function applyStoredTheme(){
    const s = new URLSearchParams(location.search).get('theme') || localStorage.getItem(THEME_KEY);
    if(s==='light'||s==='dark'){ document.documentElement.setAttribute('data-theme', s); }
  }
  toggleBtn?.addEventListener('click', ()=>{
    const cur = document.documentElement.getAttribute('data-theme') || 'auto';
    if(cur==='auto') setTheme('dark'); else if(cur==='dark') setTheme('light'); else setTheme('auto');
  });
  applyStoredTheme();

  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   * Soft refresh (cache-bust images)
   * ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function softRefresh(){
    const stamp = Date.now();
    document.querySelectorAll('img[data-asset]').forEach(img=>{
      try{
        const u = new URL(img.getAttribute('src'), location.href);
        u.searchParams.set('v', String(stamp));
        img.setAttribute('src', u.toString());
      }catch{/* no-op */}
    });
  }
  document.getElementById('refreshBtn')?.addEventListener('click', softRefresh);

  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   * Embed mode toggle (?embed=1)
   * ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function setEmbed(enabled){
    const map = {
      'umap':'./umap.html','tsne':'./tsne.html','shap':'./shap_overlay.html',
      'mu':'./mu_spectrum.html','fft':'./fft_power.html','symbolic':'./symbolic_heatmap.html',
      'calibration':'./calibration_curve.html'
    };
    if(enabled){
      Object.entries(map).forEach(([key, src])=>{
        const img = document.querySelector(`img[data-asset="${key}"]`);
        if(!img) return;
        const frame = document.createElement('iframe');
        frame.src = src;
        frame.loading = 'lazy';
        frame.title = key + ' interactive view';
        frame.setAttribute('aria-label', frame.title);
        frame.style.width = '100%';
        frame.style.height = '380px';
        frame.style.border = '1px solid var(--border)';
        frame.style.borderRadius = '10px';
        img.parentElement.replaceChild(frame, img);
      });
    }
  }
  const urlParams = new URLSearchParams(location.search);
  const embedEnabled = urlParams.get('embed') === '1';
  setEmbed(embedEnabled);
  document.getElementById('toggleEmbedBtn')?.addEventListener('click', ()=>{
    const p = new URL(location.href);
    const cur = p.searchParams.get('embed') === '1';
    p.searchParams.set('embed', cur ? '0' : '1');
    location.href = p.toString();
  });

  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   * Defensive image loader
   * ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  document.querySelectorAll('img[data-asset]').forEach(img=>{
    img.addEventListener('error', ()=>{
      img.alt = (img.alt||'Asset') + ' (unavailable)';
      img.style.opacity = '0.65';
      img.style.borderColor = 'var(--warn)';
      img.title = 'Asset not found ‚Äî check generator outputs';
    }, { once:true });
  });

  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   * Keyboard shortcuts
   * ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  function focusOverview(){ document.getElementById('sec-overview')?.focus({preventScroll:false}); }
  document.addEventListener('keydown',(e)=>{
    // Ignore when typing in inputs or with modifiers
    const tag = (e.target && e.target.tagName || '').toLowerCase();
    if(tag==='input' || tag==='textarea' || e.ctrlKey || e.metaKey || e.altKey) return;
    if(e.key==='?'){ // toggle details.help
      const d = document.querySelector('details.help');
      if(d) d.open = !d.open;
    } else if(e.key==='r'){
      e.preventDefault(); softRefresh();
    } else if(e.key==='t'){
      e.preventDefault(); toggleBtn?.click();
    } else if(e.key==='e'){
      e.preventDefault(); document.getElementById('toggleEmbedBtn')?.click();
    } else if(e.key==='g'){
      e.preventDefault(); focusOverview();
    }
  });

  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   * JSON hydration (optional)
   *   File: ./dashboard_data.json
   *   Shape (example):
   *   {
   *     "build": {"env":"ci","run":"#1289","ts":"2025-09-05T12:34:56Z"},
   *     "kpi":   {"status":"OK","gll":"-0.124","coverage":"93.1%"},
   *     "assets":{"umap":"umap_clusters.png","tsne":"tsne_projection.png", ... },
   *     "cli":   [{"when":"2025-09-05T12:00:00Z","cmd":"spectramind ...","status":"OK"}, ...]
   *   }
   * ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  async function hydrateFromJson(){
    const bust = (htmlEl.getAttribute('data-build-ts')||'') || Date.now();
    const url  = new URL('./dashboard_data.json', location.href);
    url.searchParams.set('v', String(bust));
    try{
      const res = await fetch(url.toString(), {cache:'no-store'});
      if(!res.ok) return;
      const data = await res.json();

      // Build meta
      if(data.build){
        setText('build-env', data.build.env ?? 'local');
        setText('build-run', data.build.run ?? '‚Äî');
        setText('build-ts',  data.build.ts  ?? new Date().toISOString());
      }

      // KPIs
      if(data.kpi){
        const statusEl = document.getElementById('kpi-status');
        if(statusEl && data.kpi.status){
          const s = String(data.kpi.status).toUpperCase();
          statusEl.textContent = s;
          statusEl.className = 'pill ' + (s==='OK'?'ok':s==='WARN'?'warn':s==='ERR'?'err':'info');
        }
        if(data.kpi.gll)      setText('kpi-gll', data.kpi.gll);
        if(data.kpi.coverage) setText('kpi-coverage', data.kpi.coverage);
      }

      // Assets (swap srcs)
      if(data.assets && typeof data.assets === 'object'){
        Object.entries(data.assets).forEach(([key, src])=>{
          const node = document.querySelector(`[data-asset="${key}"]`);
          if(!node) return;
          if(node.tagName === 'IMG'){
            try{
              const u = new URL(src, location.href);
              u.searchParams.set('v', String(Date.now()));
              node.setAttribute('src', u.toString());
            }catch{/* ignore */}
          }
        });
      }

      // CLI rows
      if(Array.isArray(data.cli)){
        const tbody = document.getElementById('cli-rows');
        if(tbody){
          tbody.innerHTML = '';
          data.cli.forEach(row=>{
            const tr = document.createElement('tr');
            const tdWhen = document.createElement('td');
            const tdCmd  = document.createElement('td');
            const tdStat = document.createElement('td');

            tdWhen.textContent = row.when ?? '‚Äî';
            tdCmd.innerHTML    = '<code></code>';
            tdCmd.querySelector('code').textContent = row.cmd ?? '';
            const span = document.createElement('span');
            const st = String(row.status||'INFO').toUpperCase();
            span.className = 'pill ' + (st==='OK'?'ok':st==='WARN'?'warn':st==='ERR'?'err':'info');
            span.textContent = st;

            tdStat.appendChild(span);
            tr.appendChild(tdWhen); tr.appendChild(tdCmd); tr.appendChild(tdStat);
            tbody.appendChild(tr);
          });
        }
      }
    }catch(e){
      // Soft-fail: leave seeds intact
      console.warn('No dashboard_data.json or parse error:', e);
    }
  }
  hydrateFromJson();

  /* Apply URL theme override late (allows stored theme, then URL) */
  const urlTheme = new URLSearchParams(location.search).get('theme');
  if(urlTheme==='dark'||urlTheme==='light'||urlTheme==='auto'){
    if(urlTheme==='auto') setTheme('auto'); else setTheme(urlTheme);
  }
})();
</script>


</body>
</html>
