# configs/data/toy.yaml
# ==============================================================================
# ðŸ§¸ SpectraMind V50 â€” Toy Dataset Config (Upgraded)
# ------------------------------------------------------------------------------
# Purpose:
#   Minimal synthetic dataset for CI, debugging, and dev loops.
#   Provides deterministic AIRS/FGS1 cubes with synthetic Î¼/Ïƒ targets.
#   Ensures full pipeline smoke test in < 2 min (calibrate â†’ train â†’ diagnose â†’ submit).
#
# Usage:
#   # Fast CI/dev run
#   spectramind train data=toy trainer=ci_fast
#
#   # Local quick test with debug profile
#   spectramind train data=toy local=debug
#
# Notes:
#   â€¢ Deterministic: run hash + seed ensure reproducibility.
#   â€¢ DVC-tracked, Hydra-safe, Kaggle/CI guardrails applied.
#   â€¢ Not for leaderboard submissions â€” debugging only.
# ==============================================================================

# ----------------------------------------------------------------------
# Hydra defaults (ensures clean composition)
# ----------------------------------------------------------------------
defaults:
  - override hydra/job_logging: default
  - override hydra/hydra_logging: default

# ----------------------------------------------------------------------
# Dataset metadata
# ----------------------------------------------------------------------
dataset:
  name: "toy_v50"
  description: "Synthetic toy dataset (FGS1 + AIRS) for CI/debug"
  version: "1.0"
  source: "synthetic-generator"
  dvc_stage: "data/toy"
  dvc_remote: "storage"
  cache: "data/cache/toy"
  hash: "${now:%Y%m%d}_${now:%H%M%S}"

provenance:
  git_commit: null
  dvc_rev: null
  created_at: "${now:%Y-%m-%d %H:%M:%S}"

# ----------------------------------------------------------------------
# File paths (DVC-tracked)
# ----------------------------------------------------------------------
paths:
  raw_dir: "data/raw/toy"
  processed_dir: "data/processed/toy"
  fgs1_file: "${paths.raw_dir}/fgs1_toy.npy"   # shape (64, 128, 32)
  airs_file: "${paths.raw_dir}/airs_toy.npy"   # shape (64, 32, 283)
  labels_file: "${paths.raw_dir}/labels_toy.csv"
  submission_template: "data/sample_submission.csv"

# ----------------------------------------------------------------------
# Shape & generation controls
# ----------------------------------------------------------------------
schema:
  fgs1:
    expected_rank: 3
    expected_shape: [64, 128, 32]
    dtype: "float32"
  airs:
    expected_rank: 3
    expected_shape: [64, 32, 283]
    dtype: "float32"
  labels:
    required_columns: ["planet_id", "target_mu[0:283]", "target_sigma[0:283]"]

generation:
  n_samples: 64
  fgs1_len: 128
  bins: 283
  with_targets: true
  seed: 1337

# ----------------------------------------------------------------------
# Loader parameters (CI-safe)
# ----------------------------------------------------------------------
loader:
  batch_size: 8
  num_workers: 0
  pin_memory: false
  persistent_workers: false
  shuffle: true

# ----------------------------------------------------------------------
# Calibration (synthetic placeholders)
# ----------------------------------------------------------------------
calibration:
  enabled: false          # toy dataset bypasses heavy calibration
  steps: []
  save_intermediate: false
  output_dir: "${paths.processed_dir}/calibrated"

# ----------------------------------------------------------------------
# Augmentations (lightweight only)
# ----------------------------------------------------------------------
augmentation:
  jitter:
    enabled: false
  dropout:
    enabled: false
  mask:
    enabled: false
  snr_dropout:
    enabled: false
  temporal_shift:
    enabled: false

# ----------------------------------------------------------------------
# Symbolic / physics-aware toggles
# ----------------------------------------------------------------------
symbolic:
  enforce_nonnegativity: true
  smoothness_penalty: 0.0
  fft_prior:
    enabled: false
  molecular_masking:
    enabled: false
  temporal_dropout:
    enabled: false
  region_masking:
    enabled: false
  corel_uncertainty:
    enabled: false

# ----------------------------------------------------------------------
# Splits (fixed for reproducibility)
# ----------------------------------------------------------------------
splits:
  train_fraction: 0.8
  val_fraction: 0.1
  test_fraction: 0.1
  stratify: false
  seed: 1337
  export_paths:
    indices_dir: "${paths.processed_dir}/splits"

# ----------------------------------------------------------------------
# Validation & sanity checks
# ----------------------------------------------------------------------
validate:
  enabled: true
  checks:
    - "paths_exist"
    - "schema_match"
    - "no_nan_inf"
  fail_fast: true
  sample_size_preview: 2

# ----------------------------------------------------------------------
# Diagnostics (toy artifacts for CI)
# ----------------------------------------------------------------------
diagnostics:
  save_plots: true
  fft_analysis: false
  symbolic_overlay: false
  output_dir: "outputs/diagnostics/data_toy"
  artifacts:
    stats_json: "${diagnostics.output_dir}/stats.json"
    preview_png: "${diagnostics.output_dir}/preview.png"

# ----------------------------------------------------------------------
# Runtime guardrails (CI/Kaggle safety)
# ----------------------------------------------------------------------
runtime:
  kaggle_safe: true
  max_hours: 0.05          # < 3 min runtime budget
  write_intermediates: false

# ----------------------------------------------------------------------
# Interface hooks
# ----------------------------------------------------------------------
interface:
  num_bins: 283
  output_dir: "${hydra.run.dir}"

# ----------------------------------------------------------------------
# Notes
# ----------------------------------------------------------------------
notes: |
  â€¢ Minimal synthetic dataset for CI pipelines.
  â€¢ Shapes: (64, 128, 32) FGS1, (64, 32, 283) AIRS.
  â€¢ Batch size = 8, deterministic seed = 1337.
  â€¢ Disables calibration/augmentation for speed.
  â€¢ Produces quick preview diagnostics for CI.
