<!-- =============================================================================
 SpectraMind V50 ‚Äî Diagnostics Dashboard (Seed+)
 ------------------------------------------------------------------------------
 Purpose
   ‚Ä¢ Prevent broken README/ARCHITECTURE links on first clone
   ‚Ä¢ Provide stable anchors & stub links that auto-promote when files appear
   ‚Ä¢ Clean, accessible, dark/light aware, zero external deps
   ‚Ä¢ Keeps the look minimal; adds live checks for generated artifacts
 Anchors ensured (match README hash-links):
   - #overview
   - #leaderboard  ‚Üí outputs/diagnostics/report.html (or reports/leaderboard.html)
   - #latents      ‚Üí outputs/diagnostics/umap.html, outputs/diagnostics/tsne.html
   - #explain      ‚Üí outputs/diagnostics/shap_overlay.html
   - #gll          ‚Üí outputs/diagnostics/calibration_report.html, outputs/diagnostics/gll_heatmap.png
   - #sbom         ‚Üí sbom/INDEX.json, sbom/catalog/
 ============================================================================== -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SpectraMind V50 ‚Äî Diagnostics Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <style>
    :root{
      --bg:#f9f9fb;
      --card:#ffffff;
      --ink:#1f2430;
      --muted:#6a7280;
      --accent:#2b2d42;
      --good:#18b86a;
      --warn:#f59e0b;
      --bad:#ef4444;
      --border:#e6e8f0;
      --hint:#cfd3df;
      --shadow:0 2px 6px rgba(0,0,0,.08);
      --radius:12px;
      --radius-sm:8px;
      --space:1rem;
      --space-lg:1.5rem;
      --mono: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
      --sans: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0f1115;
        --card:#151922;
        --ink:#e9e9ee;
        --muted:#9aa3b2;
        --accent:#5da9ff;
        --border:#212636;
        --hint:#2a3244;
        --shadow:0 2px 8px rgba(0,0,0,.35);
      }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      background:var(--bg);
      color:var(--ink);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* Skip link */
    .skip-link{
      position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;
    }
    .skip-link:focus{
      left:var(--space);top:var(--space);width:auto;height:auto;background:var(--card);
      border:1px solid var(--border);border-radius:8px;padding:.5rem .75rem;z-index:9999;
      box-shadow:var(--shadow);
    }

    header{
      background:var(--accent);
      color:#fff;
      padding:calc(var(--space) + .25rem) var(--space);
      box-shadow:var(--shadow);
    }
    header h1{margin:.1rem 0 0 0;font-size:1.35rem;font-weight:700}
    header p{margin:.25rem 0 0 0;opacity:.95}
    .wrap{max-width:1100px;margin:0 auto;padding:var(--space-lg) var(--space)}

    nav[aria-label="Sections"]{
      display:flex;gap:.75rem;flex-wrap:wrap;margin:0 0 var(--space-lg);
    }
    nav[aria-label="Sections"] a{
      text-decoration:none;
      color:var(--ink);
      background:var(--card);
      border:1px solid var(--border);
      border-radius:999px;
      padding:.45rem .8rem;
      box-shadow:var(--shadow);
      font-size:.92rem;
    }
    main{display:grid;gap:var(--space-lg)}
    section{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:var(--space-lg);
    }
    section h2{margin-top:0;font-size:1.15rem}
    .grid.two{
      display:grid;gap:var(--space);
      grid-template-columns:1fr;
    }
    @media (min-width:900px){ .grid.two{grid-template-columns:1fr 1fr;} }

    .placeholder{
      border:2px dashed var(--hint);
      border-radius:var(--radius-sm);
      background:transparent;
      padding:1rem;
      text-align:left;
      color:var(--muted);
      font-style:normal;
    }
    .paths{
      margin:.75rem 0 0 0;
      padding:.75rem;
      border-radius:var(--radius-sm);
      background:transparent;
      border:1px dashed var(--border);
      font-family:var(--mono);
      font-size:.9rem;
      overflow:auto;
    }
    .kbd{
      font-family:var(--mono);
      border:1px solid var(--border);
      border-bottom-width:2px;
      padding:.15rem .35rem;
      border-radius:6px;
      background:var(--card);
    }
    .small{font-size:.9rem;color:var(--muted)}

    /* Status pills */
    .pill{display:inline-flex;align-items:center;gap:.4rem;padding:.2rem .5rem;border-radius:999px;font-size:.85rem;border:1px solid var(--border);background:#ffffff12}
    .ok{color:var(--good)}
    .warn{color:var(--warn)}
    .bad{color:var(--bad)}

    details summary{cursor:pointer;font-weight:600}
    code.inline{font-family:var(--mono);background:rgba(125,125,125,.12);padding:.1rem .35rem;border-radius:6px}

    footer{ text-align:center;color:var(--muted); padding:var(--space-lg); font-size:.95rem; }

    /* Print (lightweight) */
    @media print{
      nav, .paths, .placeholder, .skip-link { display:none !important; }
      section { break-inside: avoid; box-shadow:none; border-color:#ddd; }
    }
  </style>
</head>
<body>
  <a href="#overview" class="skip-link">Skip to main content</a>

  <header role="banner">
    <div class="wrap">
      <div class="small">SpectraMind V50 ‚Ä¢ ArielSensorArray</div>
      <h1>Diagnostics Dashboard</h1>
      <p><em>Seeded placeholder ‚Äî will auto‚Äëpromote to a live dashboard once your first run lands artifacts.</em></p>
    </div>
  </header>

  <div class="wrap" role="region" aria-label="Dashboard">
    <!-- Quick Nav -->
    <nav aria-label="Sections">
      <a href="#overview">Overview</a>
      <a href="#leaderboard">Leaderboard</a>
      <a href="#latents">UMAP / t‚ÄëSNE</a>
      <a href="#explain">SHAP + Symbolic</a>
      <a href="#gll">GLL & Calibration</a>
      <a href="#sbom">SBOM</a>
    </nav>

    <main id="overview">
      <!-- Overview -->
      <section aria-labelledby="sec-overview">
        <h2 id="sec-overview">üß≠ Overview</h2>
        <div class="grid two">
          <div>
            <div class="placeholder" id="run-status">
              <strong>Status:</strong> <span class="pill warn" id="build-pill">No artifacts detected yet</span>
              <div class="small" style="margin-top:.5rem">
                This page ships as a seed so README links don‚Äôt 404. When you run diagnostics,
                cards below will light up with links and previews.
              </div>
              <div class="small" style="margin-top:.5rem">
                Last modified: <span id="last-mod">‚Äî</span>
              </div>
            </div>

            <div class="small" style="margin-top:.75rem">
              Try:
              <span class="kbd">spectramind diagnose dashboard</span>,
              <span class="kbd">make diagnostics</span> or
              <span class="kbd">spectramind train</span>
            </div>
          </div>
          <div>
            <details open>
              <summary>Expected outputs (examples)</summary>
              <div class="paths">
outputs/diagnostics/
  ‚îú‚îÄ report.html                  # summary / leaderboard
  ‚îú‚îÄ umap.html                    # interactive UMAP
  ‚îú‚îÄ tsne.html                    # interactive t‚ÄëSNE
  ‚îú‚îÄ shap_overlay.html            # SHAP overlays (per-planet / aggregate)
  ‚îú‚îÄ gll_heatmap.png              # GLL heatmap (283 bins)
  ‚îú‚îÄ calibration_report.html      # œÉ coverage / quantiles
  ‚îî‚îÄ artifacts.json               # optional manifest / summary
sbom/
  ‚îú‚îÄ INDEX.json                   # catalog index
  ‚îî‚îÄ catalog/‚Ä¶                    # signed SBOMs & reports
              </div>
            </details>
          </div>
        </div>
        <p class="small" style="margin-top:.5rem">
          Tip: You can safely commit this seed file; your CI/CLI will convert placeholders into deep links automatically.
        </p>
      </section>

      <!-- Leaderboard -->
      <section id="leaderboard" aria-labelledby="sec-leaderboard">
        <h2 id="sec-leaderboard">üìä Leaderboard Snapshot</h2>
        <div class="placeholder" data-check="outputs/diagnostics/report.html, reports/leaderboard.html">
          Leaderboard will appear here when available.
          <div class="paths">
Primary: ./outputs/diagnostics/report.html
Alternate: ./reports/leaderboard.html
          </div>
          <div class="small" id="leaderboard-status"></div>
        </div>
      </section>

      <!-- Latents -->
      <section id="latents" aria-labelledby="sec-latents">
        <h2 id="sec-latents">üåå UMAP / t‚ÄëSNE Latents</h2>
        <div class="placeholder" data-list="outputs/diagnostics/umap.html|UMAP,outputs/diagnostics/tsne.html|t‚ÄëSNE">
          Interactive latent plots will be embedded here when present.
          <div class="paths">
./outputs/diagnostics/umap.html
./outputs/diagnostics/tsne.html
          </div>
          <div class="small" id="latents-status"></div>
        </div>
      </section>

      <!-- SHAP + Symbolic -->
      <section id="explain" aria-labelledby="sec-explain">
        <h2 id="sec-explain">üîç SHAP & Symbolic Overlays</h2>
        <div class="placeholder" data-check="outputs/diagnostics/shap_overlay.html">
          SHAP explanations and symbolic overlays will appear here.
          <div class="paths">./outputs/diagnostics/shap_overlay.html</div>
          <div class="small" id="explain-status"></div>
        </div>
      </section>

      <!-- GLL & Calibration -->
      <section id="gll" aria-labelledby="sec-gll">
        <h2 id="sec-gll">üìà GLL & Calibration Heatmaps</h2>
        <div class="placeholder" data-list="outputs/diagnostics/calibration_report.html|Calibration Report,outputs/diagnostics/gll_heatmap.png|GLL Heatmap">
          Heatmaps and calibration reports will appear here.
          <div class="paths">
./outputs/diagnostics/calibration_report.html
./outputs/diagnostics/gll_heatmap.png
          </div>
          <div class="small" id="gll-status"></div>
        </div>
      </section>

      <!-- SBOM -->
      <section id="sbom" aria-labelledby="sec-sbom">
        <h2 id="sec-sbom">üì¶ SBOM Catalog</h2>
        <div class="placeholder" data-list="sbom/INDEX.json|Catalog Index,sbom/catalog/|Full Catalog Folder">
          CycloneDX/SPDX SBOMs and signatures will be linked here.
          <div class="paths">
./sbom/INDEX.json
./sbom/catalog/
          </div>
          <div class="small" id="sbom-status"></div>
        </div>
      </section>
    </main>

    <footer role="contentinfo">
      <div class="small">
        Build: <span id="build-ts" class="ok">unknown</span> ‚Ä¢ Seeded on first render ‚Ä¢ Generated by CI/CLI
      </div>
    </footer>
  </div>

  <script>
    // Lightweight artifact promotion: check for files, upgrade placeholders to deep links.
    (function(){
      const fmt = new Intl.DateTimeFormat(undefined, { dateStyle:'medium', timeStyle:'short' });
      const last = document.getElementById('last-mod');
      if (last) last.textContent = fmt.format(new Date(document.lastModified));
      const build = document.getElementById('build-ts');
      if (build) build.textContent = fmt.format(new Date());

      // Helper: HEAD request to see if a resource exists
      async function exists(url){
        try {
          const res = await fetch(url, { method:'HEAD', cache:'no-store' });
          return res.ok;
        } catch(e){ return false; }
      }

      function pill(text, cls='ok'){ return `<span class="pill ${cls}">‚óè ${text}</span>`; }

      // Upgrade single target placeholders (data-check="a,b,c")
      async function upgradeSingle(el, statusId){
        const list = (el.getAttribute('data-check') || '').split(',').map(s=>s.trim()).filter(Boolean);
        for (const url of list){
          if (await exists(url)){
            el.innerHTML = `
              <div style="display:flex;align-items:center;gap:.5rem;flex-wrap:wrap;">
                ${pill('Ready','ok')}
                <strong>Found:</strong> <a href="${url}">${url}</a>
              </div>`;
            const s = statusId && document.getElementById(statusId);
            if (s) s.innerHTML = pill('OK','ok') + ' ' + url;
            return true;
          }
        }
        const s = statusId && document.getElementById(statusId);
        if (s) s.innerHTML = pill('Waiting','warn') + ' No matching artifact yet.';
        return false;
      }

      // Upgrade multi-link placeholders (data-list="url|label,url|label")
      async function upgradeList(el, statusId){
        const pairs = (el.getAttribute('data-list') || '')
          .split(',').map(s=>s.trim()).filter(Boolean)
          .map(s => {
            const [u, l] = s.split('|'); 
            return { url:(u||'').trim(), label:(l||u||'').trim() };
          });

        let any = false;
        const ready = [];
        for (const {url, label} of pairs){
          if (!url) continue;
          const ok = await exists(url);
          if (ok) { any = true; ready.push({url,label}); }
        }

        if (any){
          const links = ready.map(({url,label}) => `<li><a href="${url}">${label}</a> <span class="small" style="opacity:.8">(${url})</span></li>`).join('');
          el.innerHTML = `
            <div style="display:flex;align-items:center;gap:.5rem;flex-wrap:wrap;margin-bottom:.5rem;">
              ${pill('Ready','ok')} <strong>Available:</strong>
            </div>
            <ul style="margin:.25rem 0 0 1rem;">${links}</ul>`;
        } else {
          // keep original content; annotate status
        }

        const s = statusId && document.getElementById(statusId);
        if (s){
          s.innerHTML = any ? pill('OK','ok') + ' Links available.'
                            : pill('Waiting','warn') + ' No artifacts found yet.';
        }
        return any;
      }

      // Apply upgrades
      const single = [
        { sel:'[data-check][id]', idFrom:'id' }, // placeholders with their own status id
      ];
      // Map fixed blocks to status spans
      const map = [
        { q:'#leaderboard .placeholder', status:'leaderboard-status', mode:'single' },
        { q:'#explain .placeholder',    status:'explain-status',     mode:'single' },
        { q:'#latents .placeholder',    status:'latents-status',     mode:'list'   },
        { q:'#gll .placeholder',        status:'gll-status',         mode:'list'   },
        { q:'#sbom .placeholder',       status:'sbom-status',        mode:'list'   },
      ];

      Promise.all(map.map(async ({q,status,mode})=>{
        const el = document.querySelector(q);
        if (!el) return false;
        return mode === 'single' ? upgradeSingle(el, status)
                                 : upgradeList(el, status);
      })).then(results=>{
        const run = document.getElementById('run-status');
        const hasAny = results.some(Boolean);
        if (run){
          run.innerHTML = hasAny
            ? `<strong>Status:</strong> ${pill('Artifacts detected','ok')} <span class="small">(This page auto‚Äëpromoted)</span>`
            : `<strong>Status:</strong> ${pill('No artifacts detected yet','warn')} <span class="small">(Placeholders active)</span>`;
        }
        const buildPill = document.getElementById('build-pill');
        if (buildPill){
          buildPill.textContent = hasAny ? 'Artifacts detected' : 'No artifacts detected yet';
          buildPill.className = 'pill ' + (hasAny ? 'ok':'warn');
        }
      });

      // Graceful fallback for image existence (if gll_heatmap.png only available as GET)
      (async function fallbackImage(){
        const gll = document.querySelector('#gll .placeholder');
        if (!gll) return;
        const want = 'outputs/diagnostics/gll_heatmap.png';
        try {
          const res = await fetch(want, {cache:'no-store'});
          if (res.ok && res.headers.get('content-type')?.includes('image')){
            // inject preview
            const url = want + '?t=' + Date.now();
            const img = `<figure style="margin:.75rem 0 0 0">
                           <img src="${url}" alt="GLL Heatmap preview" style="max-width:100%;border:1px solid var(--border);border-radius:8px"/>
                           <figcaption class="small" style="margin-top:.25rem">${want}</figcaption>
                         </figure>`;
            gll.insertAdjacentHTML('beforeend', img);
          }
        } catch(e){}
      })();

    })();
  </script>
</body>
</html>
