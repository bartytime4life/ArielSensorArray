%% SpectraMind V50 â€” Calibration Subsystem
%% Ref: CLI-first + Hydra-safe pipeline:contentReference[oaicite:0]{index=0}:contentReference[oaicite:1]{index=1}

flowchart LR
  subgraph IN["Raw Inputs"]
    FGS1["FGS1 frames (photometer)"]
    AIRS["AIRS frames (spectrometer)"]
  end

  subgraph CAL["Calibration"]
    C1["ADC Correction"]
    C2["Nonlinearity"]
    C3["Dark Subtraction"]
    C4["Flat Fielding"]
    C5["CDS / Trace Extraction"]
    C6["Normalization & Phase Align"]
  end

  subgraph OUT["Calibrated Artifacts (DVC)"]
    O1["FGS1 calibrated cube"]
    O2["AIRS calibrated cube"]
  end

  %% Orchestration & Records
  CLI["spectramind calibrate (Typer)"] -->|Hydra compose| CAL
  S1["Resolved YAML<br/>(Hydra snapshot)"]
  L1["events.jsonl / v50_debug_log.md"]

  FGS1 --> CAL
  AIRS --> CAL
  CAL --> O1
  CAL --> O2
  CAL --> L1
  CAL --> S1
